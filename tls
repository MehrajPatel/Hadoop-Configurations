________________________________________________________________
_________________________Cert Generation________________________
----------------------------------------------------------------

				--------------------------------
						On Server Only
				--------------------------------
				
sudo mkdir -p /opt/cloudera/security/x509/ /opt/cloudera/security/jks/
sudo chown -R cloudera-scm:cloudera-scm /opt/cloudera/security/jks 
sudo chown -R cloudera-scm:cloudera-scm /opt/cloudera/security/x509
sudo umask 0700
cd /opt/cloudera/security/jks

#generate keypair 

sudo -u cloudera-scm $JAVA_HOME/bin/keytool \
-genkeypair \
-alias `hostname -f` \
-keyalg RSA \
-keystore /opt/cloudera/security/jks/`hostname -f`.jks \
-keysize 2048 \
-dname "CN=`hostname -f`,OU=Engineering,O=Cloudera,L=Palo Alto,ST=California,C=US" \
-ext san=dns:`hostname -f` \
-keypass P@ssw0rd \
-storepass P@ssw0rd

ln -s /opt/cloudera/security/jks/`hostname -f`.jks /opt/cloudera/security/jks/server.jks



sudo -u cloudera-scm $JAVA_HOME/bin/keytool \
-export \
-alias `hostname -f` \
-keystore /opt/cloudera/security/jks/server.jks \
-rfc \
-file /tmp/selfsigned.cer

cp /tmp/selfsigned.cer /opt/cloudera/security/x509/cloudera.pem

scp selfsigned.cer and and /opt/cloudera/security/x509/cloudera.pem to all the hosts and perform following operations on all the hosts(server + agents)

				--------------------------------
						On All Hosts
				--------------------------------
				
sudo cp $JAVA_HOME/jre/lib/security/cacerts $JAVA_HOME/jre/lib/security/jssecacerts

#import cert to truststore
sudo $JAVA_HOME/bin/keytool \
-import \
-alias `hostname -f` \
-file /opt/cloudera/security/jks/selfsigned.cer \
-storepass changeit \
-storetype JKS \
-keystore $JAVA_HOME/jre/lib/security/jssecacerts

chown cloudera-scm:cloudera-scm $JAVA_HOME/jre/lib/security/jssecacerts
chmod 777 $JAVA_HOME/jre/lib/security/jssecacerts

________________________________________________________________
__________________Configuration Changes on CM___________________
----------------------------------------------------------------


goto Administration > Settings > Security 

Property													Description
Cloudera Manager TLS/SSL Server JKS Keystore File Location	/opt/cloudera/security/jks/server.jks
Cloudera Manager TLS/SSL Server JKS Keystore File Password	P@ssw0rd
Use TLS Encryption for Admin Console						Checked

go to the Cloudera Management Service service Configuration > Cloudera Management Service (Service-Wide) > Security.

Property											Description
TLS/SSL Client Truststore File Location				$JAVA_HOME/jre/lib/security/jssecacerts (replace $JAVA_HOME with absolute path)
Cloudera Manager Server TLS/SSL Certificate 		changeit
Trust Store Password

#Restart Cloudera Manager and Services
sudo systemctl restart cloudera-scm-server

#Result of following command should be OK
openssl s_client -connect 54.190.7.82:7183 -CAfile /opt/cloudera/security/x509/cloudera.pem

________________________________________________________________
_____________Configure TLS for Cloudera Manager Agents__________
----------------------------------------------------------------

Administration > Settings > Security category > Use TLS Encryption for Agents option.

#change use_tls property in /etc/cloudera-scm-agent/config.ini as follows

use_tls=1

sudo systemctl restart cloudera-scm-server
sudo systemctl restart cloudera-scm-agent

_____________________________________________________________________________
______Enable Server Certificate Verification on Cloudera Manager Agents______
-----------------------------------------------------------------------------
#change verify_cert_file property in /etc/cloudera-scm-agent/config.ini as follows

verify_cert_file=/opt/cloudera/security/x509/cloudera.pem

sudo systemctl restart cloudera-scm-agent
